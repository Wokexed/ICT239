{% extends "base.html" %}

{% block title %}Add a Book - SG Library{% endblock %}

{% block page_title %}ADD A BOOK{% endblock %}

{% block extra_css %}
<style>
    .add-book-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 30px;
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    #description {
        width: 100%;
        height: 200px;
        resize: vertical; /* allows user to resize vertically only */
    }

    .form-section {
        margin-bottom: 15px;
    }

    .form-section {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 20px;
        align-items: start;
        margin-bottom: 15px;
    }

    .form-section:not(.authors-section) label {
        padding-top: 10px;
    }

    .form-section:not(.authors-section) label {
        font-weight: 600;
        color: #333;
        padding-top: 10px;
    }

    .form-section input[type="text"],
    .form-section input[type="number"],
    .form-section input[type="url"],
    .form-section select,
    .form-section textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        font-family: Arial, sans-serif;
        box-sizing: border-box;
    }
    .form-section select[multiple] {         
        height: 80px;
        overflow-y: auto;
        background-color: #fff;
    }
    .form-section textarea {
        resize: vertical;
        min-height: 120px;
    }

    .form-section input:focus,
    .form-section select:focus,
    .form-section textarea:focus {
        outline: none;
        border-color: #4c9c4c;
        box-shadow: 0 0 5px rgba(76, 156, 76, 0.3);
    }

    .multi-select {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
        margin-top: 10px;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: #f9f9f9;
    }

    .multi-select label {
        display: flex;
        align-items: center;
        margin: 0;
        font-weight: normal;
        cursor: pointer;
    }

    .multi-select input[type="checkbox"] {
        margin-right: 8px;
        width: auto;
        cursor: pointer;
    }

    .author-row {
        display: grid;
        grid-template-columns: 1fr 150px auto; /* last column auto to fit button text */
        gap: 15px;
        align-items: center;
        margin-bottom: 12px;
        padding: 12px;
        background-color: #f9f9f9;
        border-radius: 4px;
    }

    .author-row input[type="text"] {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .author-row .form-check {
        display: flex;
        align-items: center;
        margin: 0;
    }

    .form-check-label {
        margin-left: 8px;
        font-size: 14px;
        cursor: pointer;
        font-weight: normal;
        white-space: nowrap;
    }

    .author-buttons {
        display: flex;
        gap: 8px;
    }

    .btn-add-author,
    .btn-remove-author {
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        font-size: 13px;
        cursor: pointer;
        font-weight: 600;
        white-space: nowrap;
    }

    .btn-add-author {
        background-color: #4c9c4c;
        color: white;
    }

    .btn-add-author:hover {
        background-color: #4cae4c;
    }

    .btn-remove-author {
        background-color: #dc3545;
        color: white;
    }

    .btn-remove-author:hover {
        background-color: #c82333;
    }

    .form-row {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .submit-button {
        background-color: #4c9c4c;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
    }

    .submit-container {
        display: flex;                 /* enable flex layout */
        justify-content: flex-end;     /* push button to the right */
        margin-top: 20px;              /* spacing above button */
    }
    
    .submit-button:hover {
        background-color: #4cae4c;
    }

    .form-note {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }

    .authors-section {
        margin-top: 10px;
    }

    .author-instructions {
        font-size: 13px;
        color: #666;
        margin-bottom: 12px;
        padding: 10px;
        background-color: #f0f8f0;
        border-left: 3px solid #4c9c4c;
        border-radius: 3px;
    }

    @media (max-width: 768px) {
        .form-section {
            grid-template-columns: 1fr;
        }

        .author-row {
            grid-template-columns: 1fr;
        }

        .submit-button {
            margin-left: 0;
        }

        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="add-book-container">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" action="">
<!-- Genres Section -->
        <div class="form-section">
            <label for="genres">Choose multiple Genres:</label>
            <select id="genres" name="genres" multiple size="6">
                {% set genres = ["Animals", "Business", "Comics", "Communication", "Dark Academia", "Emotion", "Fantasy", "Fiction", "Friendship", "Graphic Novels", "Grief", "Historical Fiction", "Indigenous", "Inspirational", "Magic", "Mental Health", "Nonfiction", "Personal Development", "Philosophy", "Picture Books", "Poetry", "Productivity", "Psychology", "Romance", "School", "Self Help"] %}
                {% for genre in genres %}
                    <option value="{{ genre }}"
                        {% if form_data and genre in form_data.genres %}selected{% endif %}>
                        {{ genre }}
                    </option>
                {% endfor %}
            </select>
        </div>


        <!-- Title -->
        <div class="form-section">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required
                value="{{ form_data.title if form_data else '' }}">
        </div>

        <!-- Category -->
        <div class="form-section">
            <label for="category">Choose a category:</label>
            <select id="category" name="category" required>
                <option value="Children" selected>Children</option>
                <option value="Young Adult" {% if form_data and form_data.category == 'Young Adult' %}selected{% endif %}>Young Adult</option>
                <option value="Adult" {% if form_data and form_data.category == 'Adult' %}selected{% endif %}>Adult</option>
                <option value="Educational" {% if form_data and form_data.category == 'Educational' %}selected{% endif %}>Educational</option>
                <option value="Reference" {% if form_data and form_data.category == 'Reference' %}selected{% endif %}>Reference</option>
            </select>
        </div>


        <!-- URL for Cover -->
        <div class="form-section">
            <label for="cover_url">URL for Cover:</label>
            <input type="url" id="cover_url" name="cover_url"
                value="{{ form_data.cover_url if form_data else '' }}">
        </div>

        <!-- Description -->
        <div class="form-section">
            <label for="description">Description:</label>
            <textarea id="description" name="description">{{ form_data.description if form_data else '' }}</textarea>
        </div>

        <!-- Authors Section -->
        
        <div class="form-section">
            <label>Authors:</label>
            <div>
                <div class="author-instructions">
                    Add as many authors as needed. Use the "+ Add Author" button to add more, and "Remove" to delete an author row.
                </div>
                <div id="authors-container">
                    {% set author_count = form_data.author_names|length if form_data and form_data.author_names else 1 %}
                    {% for i in range(author_count) %}
                        <div class="author-row">
                            <input type="text" name="author_name"
                                value="{{ form_data.author_names[i] if form_data and i < form_data.author_names|length else '' }}">
                            <div class="form-check">
                                <input type="checkbox" id="illustrator_{{ i }}" name="author_illustrator" value="{{ i }}" class="form-check-input"
                                    {% if form_data and i|string in form_data.author_illustrators %}checked{% endif %}>
                                <label class="form-check-label" for="illustrator_{{ i }}">Illustrator</label>
                            </div>
                            <!-- Always show add button -->
                            <button type="submit" name="add_author" value="true" class="btn-add-author">+ Add Author</button>
                            <!-- Show remove button only if more than 1 author -->
                            {% if author_count > 1 %}
                                <button type="submit" name="remove_author" value="{{ i }}" class="btn-remove-author">Remove</button>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Number of Pages and Copies -->
        <div class="form-row">
            <div class="form-section">
                <label for="num_pages">Number of pages:</label>
                <input type="number" id="num_pages" name="num_pages" min="1"
                    value="{{ form_data.num_pages if form_data else '' }}">
            </div>
            <div class="form-section">
                <label for="num_copies">Number of copies:</label>
                <input type="number" id="num_copies" name="num_copies" min="1"
                    value="{{ form_data.num_copies if form_data else '' }}">
            </div>
        </div>

        <!-- Submit Button -->
        <div class="submit-container">
            <button type="submit" name="submit_book" value="true" class="submit-button">Submit</button>
        </div>
    </form>
</div>
{% endblock %}